#!/bin/bash
IP=$1
echo "Detectar IP si es de la red TOR ${1}"
if [ "$(cat ipblock.txt | grep $IP)" == "" ]; then

    
    DATE=$(date '+%Y-%m-%d')
    echo $DATE
    DATEMENOS=$(date --date='-2 day' +%Y-%m-%d)
    #echo $DATEMENOS

    RESULTADOCURL=$(curl "https://metrics.torproject.org/exonerator.html?ip=$IP&timestamp=$DATEMENOS&lang=en" -m 10| grep "Result is")
    #echo $RESULTADOCURL

    if
        [ "Result is positive" == "$(echo ${RESULTADOCURL:38:18})" ]
    then
		echo "${1} PERTENECE A LA RED TOR"
        echo $IP >>ipblock.txt
        echo "deny"

    else RESULTADOCURLif [[ $string == *"My long"* ]]; then
  				echo "It's there!"
		fi 
		else
    			echo "${1} NO PERTENECE A LA RED TOR"
        		echo "allow"
    fi
else
    echo "deny"
fi
